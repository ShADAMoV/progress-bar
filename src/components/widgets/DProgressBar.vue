<script setup>
import { useProgressStore } from '@/stores/progress';
import { ref } from 'vue';
const progressStore = useProgressStore();
const { progress } = progressStore;

const progressBar = ref(null);

/*
Так как мы имеем 6 секций, то необходимо для каждой из них, рассчитать процент заполненности.
Чтобы найти промежуток, который надо закрашивать, мы проверяем, сколько очков собрал пользователь.
*/
const [ sectionOne, sectionTwo, sectionThree, sectionFour, sectionFive, sectionLimit ] = [25, 50, 100, 200, 500, 1000];
const sectionSize = 16.7;
const getScaleWidth = progress <= sectionOne ? `width: ${progress / sectionOne * sectionSize}%` :
          progress <= sectionTwo ? `width: ${(progress - sectionOne) / (sectionTwo - sectionOne) * sectionSize + sectionSize}%` :
              progress <= sectionThree ? `width: ${(progress - sectionTwo) / (sectionThree - sectionTwo) * sectionSize + sectionSize * 2}%` :
                  progress <= sectionFour ? `width: ${(progress - sectionThree) / (sectionFour - sectionThree) * sectionSize + sectionSize * 3}%` :
                      progress <= sectionFive ? `width: ${(progress - sectionFour) / (sectionFive - sectionFour) * sectionSize + sectionSize * 4}%` :
                          progress >= sectionFive + sectionLimit / 100 * 10 ? `width: ${((progress - sectionFive) / (sectionLimit - sectionFive) * sectionSize + sectionSize * 5) - 0.2}%; border-radius: 30px` : // Из-за особенности макета, где в последнем промежутке, шкала имеет закругленный вид, был добавлен данный код. P.S. "-0.2" нужно, чтобы не появлялась горизонтальная полоса прокрутки
                              `width: ${(progress - sectionFive) / (sectionLimit - sectionFive) * sectionSize + sectionSize * 5}%`;
</script>

<template>
  <div class="d-progress-bar">
    <div class="d-progress-bar__stars stars">
      <div
        style="left: 5px"
        class="stars__item"
      >
        <svg
          v-show="sectionOne > progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.9059 1.13178C8.9154 1.10294 8.92794 1.09136 8.93812 1.08452C8.95159 1.07546 8.9731 1.06763 9 1.06763C9.02689 1.06763 9.04841 1.07546 9.06188 1.08452C9.07206 1.09136 9.0846 1.10294 9.0941 1.13178L10.8086 6.33558C10.9574 6.78724 11.3812 7.08682 11.8525 7.08682H17.4006C17.4359 7.08682 17.4531 7.09655 17.4627 7.10389C17.4752 7.11343 17.4876 7.12945 17.4947 7.15098C17.5018 7.17252 17.5009 7.19123 17.4972 7.20373C17.4946 7.21254 17.4881 7.22832 17.461 7.24775L12.9725 10.4639C12.587 10.7401 12.4222 11.2335 12.5715 11.6864L14.2859 16.8902C14.2954 16.919 14.2917 16.9339 14.2886 16.9426C14.284 16.9552 14.2729 16.9723 14.2523 16.987C14.2317 17.0017 14.2099 17.0082 14.1922 17.0088C14.1783 17.0092 14.1587 17.0065 14.1314 16.987L9.64288 13.7709C9.25908 13.4959 8.74092 13.4959 8.35712 13.7709L3.86859 16.987C3.84135 17.0065 3.82174 17.0092 3.8078 17.0088C3.79014 17.0082 3.76828 17.0017 3.74772 16.987C3.72714 16.9723 3.71601 16.9552 3.71144 16.9426C3.70827 16.9339 3.70459 16.919 3.71405 16.8902L5.42852 11.6864C5.57775 11.2335 5.41295 10.7401 5.02751 10.4639L0.538985 7.24775C0.511869 7.22832 0.505441 7.21254 0.502831 7.20373C0.499129 7.19123 0.498223 7.17251 0.505318 7.15098C0.512411 7.12945 0.524794 7.11342 0.537297 7.10389C0.546916 7.09655 0.56409 7.08682 0.599422 7.08682H6.14755C6.61885 7.08682 7.04263 6.78724 7.19143 6.33559L8.9059 1.13178Z"
            stroke="red"
          />
        </svg>
        <svg
          v-show="sectionOne <= progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.43101 0.975079C8.6101 0.431485 9.3899 0.431484 9.56899 0.975078L11.2835 6.17888C11.3636 6.42198 11.5933 6.58658 11.8525 6.58658H17.4006C17.9801 6.58658 18.2211 7.31798 17.7522 7.65394L13.2637 10.8701C13.054 11.0203 12.9663 11.2866 13.0464 11.5297L14.7608 16.7335C14.9399 17.2771 14.3091 17.7292 13.8402 17.3932L9.35166 14.1771C9.14197 14.0268 8.85803 14.0268 8.64834 14.1771L4.15981 17.3932C3.69094 17.7292 3.06007 17.2771 3.23916 16.7335L4.95363 11.5297C5.03372 11.2866 4.94598 11.0203 4.73629 10.8701L0.247765 7.65394C-0.221112 7.31798 0.0198585 6.58658 0.599422 6.58658H6.14755C6.40674 6.58658 6.63645 6.42198 6.71654 6.17888L8.43101 0.975079Z"
            fill="red"
          />
        </svg>
      </div>
      <div
        style="left: 3px"
        class="stars__item"
      >
        <svg
          v-show="sectionTwo > progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.9059 1.13178C8.9154 1.10294 8.92794 1.09136 8.93812 1.08452C8.95159 1.07546 8.9731 1.06763 9 1.06763C9.02689 1.06763 9.04841 1.07546 9.06188 1.08452C9.07206 1.09136 9.0846 1.10294 9.0941 1.13178L10.8086 6.33558C10.9574 6.78724 11.3812 7.08682 11.8525 7.08682H17.4006C17.4359 7.08682 17.4531 7.09655 17.4627 7.10389C17.4752 7.11343 17.4876 7.12945 17.4947 7.15098C17.5018 7.17252 17.5009 7.19123 17.4972 7.20373C17.4946 7.21254 17.4881 7.22832 17.461 7.24775L12.9725 10.4639C12.587 10.7401 12.4222 11.2335 12.5715 11.6864L14.2859 16.8902C14.2954 16.919 14.2917 16.9339 14.2886 16.9426C14.284 16.9552 14.2729 16.9723 14.2523 16.987C14.2317 17.0017 14.2099 17.0082 14.1922 17.0088C14.1783 17.0092 14.1587 17.0065 14.1314 16.987L9.64288 13.7709C9.25908 13.4959 8.74092 13.4959 8.35712 13.7709L3.86859 16.987C3.84135 17.0065 3.82174 17.0092 3.8078 17.0088C3.79014 17.0082 3.76828 17.0017 3.74772 16.987C3.72714 16.9723 3.71601 16.9552 3.71144 16.9426C3.70827 16.9339 3.70459 16.919 3.71405 16.8902L5.42852 11.6864C5.57775 11.2335 5.41295 10.7401 5.02751 10.4639L0.538985 7.24775C0.511869 7.22832 0.505441 7.21254 0.502831 7.20373C0.499129 7.19123 0.498223 7.17251 0.505318 7.15098C0.512411 7.12945 0.524794 7.11342 0.537297 7.10389C0.546916 7.09655 0.56409 7.08682 0.599422 7.08682H6.14755C6.61885 7.08682 7.04263 6.78724 7.19143 6.33559L8.9059 1.13178Z"
            stroke="red"
          />
        </svg>
        <svg
          v-show="sectionTwo <= progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.43101 0.975079C8.6101 0.431485 9.3899 0.431484 9.56899 0.975078L11.2835 6.17888C11.3636 6.42198 11.5933 6.58658 11.8525 6.58658H17.4006C17.9801 6.58658 18.2211 7.31798 17.7522 7.65394L13.2637 10.8701C13.054 11.0203 12.9663 11.2866 13.0464 11.5297L14.7608 16.7335C14.9399 17.2771 14.3091 17.7292 13.8402 17.3932L9.35166 14.1771C9.14197 14.0268 8.85803 14.0268 8.64834 14.1771L4.15981 17.3932C3.69094 17.7292 3.06007 17.2771 3.23916 16.7335L4.95363 11.5297C5.03372 11.2866 4.94598 11.0203 4.73629 10.8701L0.247765 7.65394C-0.221112 7.31798 0.0198585 6.58658 0.599422 6.58658H6.14755C6.40674 6.58658 6.63645 6.42198 6.71654 6.17888L8.43101 0.975079Z"
            fill="red"
          />
        </svg>
      </div>
      <div class="stars__item">
        <svg
          v-show="sectionThree > progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.9059 1.13178C8.9154 1.10294 8.92794 1.09136 8.93812 1.08452C8.95159 1.07546 8.9731 1.06763 9 1.06763C9.02689 1.06763 9.04841 1.07546 9.06188 1.08452C9.07206 1.09136 9.0846 1.10294 9.0941 1.13178L10.8086 6.33558C10.9574 6.78724 11.3812 7.08682 11.8525 7.08682H17.4006C17.4359 7.08682 17.4531 7.09655 17.4627 7.10389C17.4752 7.11343 17.4876 7.12945 17.4947 7.15098C17.5018 7.17252 17.5009 7.19123 17.4972 7.20373C17.4946 7.21254 17.4881 7.22832 17.461 7.24775L12.9725 10.4639C12.587 10.7401 12.4222 11.2335 12.5715 11.6864L14.2859 16.8902C14.2954 16.919 14.2917 16.9339 14.2886 16.9426C14.284 16.9552 14.2729 16.9723 14.2523 16.987C14.2317 17.0017 14.2099 17.0082 14.1922 17.0088C14.1783 17.0092 14.1587 17.0065 14.1314 16.987L9.64288 13.7709C9.25908 13.4959 8.74092 13.4959 8.35712 13.7709L3.86859 16.987C3.84135 17.0065 3.82174 17.0092 3.8078 17.0088C3.79014 17.0082 3.76828 17.0017 3.74772 16.987C3.72714 16.9723 3.71601 16.9552 3.71144 16.9426C3.70827 16.9339 3.70459 16.919 3.71405 16.8902L5.42852 11.6864C5.57775 11.2335 5.41295 10.7401 5.02751 10.4639L0.538985 7.24775C0.511869 7.22832 0.505441 7.21254 0.502831 7.20373C0.499129 7.19123 0.498223 7.17251 0.505318 7.15098C0.512411 7.12945 0.524794 7.11342 0.537297 7.10389C0.546916 7.09655 0.56409 7.08682 0.599422 7.08682H6.14755C6.61885 7.08682 7.04263 6.78724 7.19143 6.33559L8.9059 1.13178Z"
            stroke="red"
          />
        </svg>
        <svg
          v-show="sectionThree <= progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.43101 0.975079C8.6101 0.431485 9.3899 0.431484 9.56899 0.975078L11.2835 6.17888C11.3636 6.42198 11.5933 6.58658 11.8525 6.58658H17.4006C17.9801 6.58658 18.2211 7.31798 17.7522 7.65394L13.2637 10.8701C13.054 11.0203 12.9663 11.2866 13.0464 11.5297L14.7608 16.7335C14.9399 17.2771 14.3091 17.7292 13.8402 17.3932L9.35166 14.1771C9.14197 14.0268 8.85803 14.0268 8.64834 14.1771L4.15981 17.3932C3.69094 17.7292 3.06007 17.2771 3.23916 16.7335L4.95363 11.5297C5.03372 11.2866 4.94598 11.0203 4.73629 10.8701L0.247765 7.65394C-0.221112 7.31798 0.0198585 6.58658 0.599422 6.58658H6.14755C6.40674 6.58658 6.63645 6.42198 6.71654 6.17888L8.43101 0.975079Z"
            fill="red"
          />
        </svg>
      </div>
      <div
        style="right: 3px"
        class="stars__item"
      >
        <svg
          v-show="sectionFour > progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.9059 1.13178C8.9154 1.10294 8.92794 1.09136 8.93812 1.08452C8.95159 1.07546 8.9731 1.06763 9 1.06763C9.02689 1.06763 9.04841 1.07546 9.06188 1.08452C9.07206 1.09136 9.0846 1.10294 9.0941 1.13178L10.8086 6.33558C10.9574 6.78724 11.3812 7.08682 11.8525 7.08682H17.4006C17.4359 7.08682 17.4531 7.09655 17.4627 7.10389C17.4752 7.11343 17.4876 7.12945 17.4947 7.15098C17.5018 7.17252 17.5009 7.19123 17.4972 7.20373C17.4946 7.21254 17.4881 7.22832 17.461 7.24775L12.9725 10.4639C12.587 10.7401 12.4222 11.2335 12.5715 11.6864L14.2859 16.8902C14.2954 16.919 14.2917 16.9339 14.2886 16.9426C14.284 16.9552 14.2729 16.9723 14.2523 16.987C14.2317 17.0017 14.2099 17.0082 14.1922 17.0088C14.1783 17.0092 14.1587 17.0065 14.1314 16.987L9.64288 13.7709C9.25908 13.4959 8.74092 13.4959 8.35712 13.7709L3.86859 16.987C3.84135 17.0065 3.82174 17.0092 3.8078 17.0088C3.79014 17.0082 3.76828 17.0017 3.74772 16.987C3.72714 16.9723 3.71601 16.9552 3.71144 16.9426C3.70827 16.9339 3.70459 16.919 3.71405 16.8902L5.42852 11.6864C5.57775 11.2335 5.41295 10.7401 5.02751 10.4639L0.538985 7.24775C0.511869 7.22832 0.505441 7.21254 0.502831 7.20373C0.499129 7.19123 0.498223 7.17251 0.505318 7.15098C0.512411 7.12945 0.524794 7.11342 0.537297 7.10389C0.546916 7.09655 0.56409 7.08682 0.599422 7.08682H6.14755C6.61885 7.08682 7.04263 6.78724 7.19143 6.33559L8.9059 1.13178Z"
            stroke="red"
          />
        </svg>
        <svg
          v-show="sectionFour <= progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.43101 0.975079C8.6101 0.431485 9.3899 0.431484 9.56899 0.975078L11.2835 6.17888C11.3636 6.42198 11.5933 6.58658 11.8525 6.58658H17.4006C17.9801 6.58658 18.2211 7.31798 17.7522 7.65394L13.2637 10.8701C13.054 11.0203 12.9663 11.2866 13.0464 11.5297L14.7608 16.7335C14.9399 17.2771 14.3091 17.7292 13.8402 17.3932L9.35166 14.1771C9.14197 14.0268 8.85803 14.0268 8.64834 14.1771L4.15981 17.3932C3.69094 17.7292 3.06007 17.2771 3.23916 16.7335L4.95363 11.5297C5.03372 11.2866 4.94598 11.0203 4.73629 10.8701L0.247765 7.65394C-0.221112 7.31798 0.0198585 6.58658 0.599422 6.58658H6.14755C6.40674 6.58658 6.63645 6.42198 6.71654 6.17888L8.43101 0.975079Z"
            fill="red"
          />
        </svg>
      </div>
      <div
        style="right: 5px"
        class="stars__item"
      >
        <svg
          v-show="sectionFive > progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.9059 1.13178C8.9154 1.10294 8.92794 1.09136 8.93812 1.08452C8.95159 1.07546 8.9731 1.06763 9 1.06763C9.02689 1.06763 9.04841 1.07546 9.06188 1.08452C9.07206 1.09136 9.0846 1.10294 9.0941 1.13178L10.8086 6.33558C10.9574 6.78724 11.3812 7.08682 11.8525 7.08682H17.4006C17.4359 7.08682 17.4531 7.09655 17.4627 7.10389C17.4752 7.11343 17.4876 7.12945 17.4947 7.15098C17.5018 7.17252 17.5009 7.19123 17.4972 7.20373C17.4946 7.21254 17.4881 7.22832 17.461 7.24775L12.9725 10.4639C12.587 10.7401 12.4222 11.2335 12.5715 11.6864L14.2859 16.8902C14.2954 16.919 14.2917 16.9339 14.2886 16.9426C14.284 16.9552 14.2729 16.9723 14.2523 16.987C14.2317 17.0017 14.2099 17.0082 14.1922 17.0088C14.1783 17.0092 14.1587 17.0065 14.1314 16.987L9.64288 13.7709C9.25908 13.4959 8.74092 13.4959 8.35712 13.7709L3.86859 16.987C3.84135 17.0065 3.82174 17.0092 3.8078 17.0088C3.79014 17.0082 3.76828 17.0017 3.74772 16.987C3.72714 16.9723 3.71601 16.9552 3.71144 16.9426C3.70827 16.9339 3.70459 16.919 3.71405 16.8902L5.42852 11.6864C5.57775 11.2335 5.41295 10.7401 5.02751 10.4639L0.538985 7.24775C0.511869 7.22832 0.505441 7.21254 0.502831 7.20373C0.499129 7.19123 0.498223 7.17251 0.505318 7.15098C0.512411 7.12945 0.524794 7.11342 0.537297 7.10389C0.546916 7.09655 0.56409 7.08682 0.599422 7.08682H6.14755C6.61885 7.08682 7.04263 6.78724 7.19143 6.33559L8.9059 1.13178Z"
            stroke="red"
          />
        </svg>
        <svg
          v-show="sectionFive <= progress"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.43101 0.975079C8.6101 0.431485 9.3899 0.431484 9.56899 0.975078L11.2835 6.17888C11.3636 6.42198 11.5933 6.58658 11.8525 6.58658H17.4006C17.9801 6.58658 18.2211 7.31798 17.7522 7.65394L13.2637 10.8701C13.054 11.0203 12.9663 11.2866 13.0464 11.5297L14.7608 16.7335C14.9399 17.2771 14.3091 17.7292 13.8402 17.3932L9.35166 14.1771C9.14197 14.0268 8.85803 14.0268 8.64834 14.1771L4.15981 17.3932C3.69094 17.7292 3.06007 17.2771 3.23916 16.7335L4.95363 11.5297C5.03372 11.2866 4.94598 11.0203 4.73629 10.8701L0.247765 7.65394C-0.221112 7.31798 0.0198585 6.58658 0.599422 6.58658H6.14755C6.40674 6.58658 6.63645 6.42198 6.71654 6.17888L8.43101 0.975079Z"
            fill="red"
          />
        </svg>
      </div>
    </div>

    <div
      ref="progressBar"
      class="d-progress-bar__scale scale"
    >
      <div
        ref="progressScale"
        :style="getScaleWidth"
        class="scale__progress"
      />
      <div
        :style="`left:${sectionSize}`"
        class="scale__separator"
      />
      <div class="scale__separator" />
      <div class="scale__separator" />
      <div class="scale__separator" />
      <div class="scale__separator" />
    </div>
  </div>
</template>

<style lang="scss">
.d-progress-bar {
  &__scale {
    margin: 10px 0;
  }

  &__stars {
    position: relative;
    display: flex;
    justify-content: space-evenly;
  }
}

.scale {
  position: relative;
  width: 100%;
  height: 40px;
  background: rgba(239, 239, 239, 0.6);
  border-radius: 30px;
  display: flex;
  justify-content: space-evenly;
  align-items: center;

  &__progress {
    content: '';
    height: 40px;
    background: #3300FF;
    border-radius: 30px 0 0 30px;
    position: absolute;
    left: 0;
  }

  &__separator {
    height: 100%;
    width: 2px;
    background: black;
    opacity: 0.2;
  }
}

.stars {
  &__item {
    position: relative;
  }

  & svg {
  }
}
</style>
